<%- contentFor('css') %>
<link rel="stylesheet" href="/plugins/morris/morris.css" />

<%- contentFor('content') %>

<!-- Start content -->
<div class="content">
    <div class="container">
        <!-- Page-Title -->
        <div class="row">
            <div class="col-sm-12">
                <div class="page-title-box">
                    <ol class="breadcrumb pull-right">
                        <li><a href="#">Home</a></li>
                        <li class="active">사용자 관리</li>
                    </ol>
                    <h4 class="page-title">사용자 조회</h4>
                </div>
            </div>
        </div>
        <!-- 사용자 추가 버튼 -->
        <button type="button" class="btn btn-primary waves-effect waves-light m-l-10 btn-md pull-right" id="addUser">사용자 추가 <i class="fa fa-plus"></i></button>

        <!-- 유저리스트 테이블 -->
        <table class="table table-hover" style="background-color: #eee">
            <tr style="background-color: #fff">
                <td>
                    <font size="2pt"
                        ><strong><center>번호</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>구분</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>아이디</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>활성상태</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>생성일</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>수정일</center></strong></font
                    >
                </td>
                <td>
                    <font size="2pt"
                        ><strong><center>ETC</center></strong></font
                    >
                </td>
            </tr>
            <% list.forEach(item => { %>
            <tr>
                <td><%= item.SEQ %></td>
                <td><%= item.USERTYPE %></td>
                <td><%= item.LOGINID %></td>
                <td><%= item.ACTIVE %></td>
                <td><%= moment(item.CREATED).format('YYYY-MM-DD hh:mm:ss') %></td>
                <td><%= moment(item.MODIFIED).format('YYYY-MM-DD hh:mm:ss') %></td>
                <td class="actions">
                    <a href="#" class="on-default edit-row" onclick="javascript:editUser(<%=item.SEQ %>);"><i class="fa fa-pencil"></i></a>
                    <a href="#" class="on-default remove-row" onclick="javascript:removeUser(<%=item.SEQ %>);"><i class="fa fa-trash-o"></i></a>
                </td>
            </tr>
            <% }) %>
        </table>
        <div>
            <div class="col-lg-3 col-md-3">
                <input type="text" id="simpleinput" class="form-control" placeholder="유저 검색" />
            </div>
        </div>
        <!-- </div> -->
        <!-- 페이지네이션 -->
        <div class="row">
            <div class="row" style="text-align: center">
                <ul class="pagination pagination-split" id="users-page"></ul>
            </div>
        </div>
    </div>
    <!-- end container -->
</div>
<!-- end content -->

<input type="hidden" id="saveType" />
<input type="hidden" id="SEQ" />
<div id="userEditModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="martEditModal" aria-hidden="true" style="display: none">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="userEditModal-Title"></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="name" class="control-label">구분</label>
                            <input type="text" class="form-control" id="NAME" placeholder="'U' OR 'M'" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="address" class="control-label">아이디</label>
                            <input type="text" class="form-control" id="REGNO" placeholder="LOGIN ID" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="address" class="control-label">활성상태</label>
                            <input type="text" class="form-control" id="POSTCODE" placeholder="'Y' OR 'N'" />
                        </div>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="address" class="control-label">상세 주소</label>
                            <input type="text" class="form-control" id="ADDRESSEXTRA" placeholder="상세 주소" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="contact" class="control-label">인사 담당자</label>
                            <input type="text" class="form-control" id="HRONAME" placeholder="인사 담당자" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="address" class="control-label">인사 담당자 직급</label>
                            <input type="text" class="form-control" id="HRORANK" placeholder="인사 담당자 직급" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="location" class="control-label">인사 담당자 연락처</label>
                            <input type="text" class="form-control" id="HROCONTACT" placeholder="인사 담당자 연락처" />
                        </div>
                    </div> -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">닫기</button>
                <button type="button" class="btn btn-info waves-effect waves-light" id="button-actionSave">저장</button>
            </div>
        </div>
    </div>
</div>
<!-- /.martEditModal -->
<%- contentFor('script') %>

<script>
        var totalCount =<%=totalCount %>;
        var page = <%=page %>;
        var rowCount = <%=rowCount %>;

        // 유저 삭제
        function removeUser(userseq) {
            console.log(userseq);
            self.location = `/user/remove/`+userseq;
        };
        // 유저 수정
        function editUser(userseq) {
            $('#userEditModal-Title').html("마트 정보 변경");

            $("#saveType").val("edit");

            doGetCallSync("/user/get/" + userseq)
            .success(function(json){
                if (json.result == "success") {
                    $("#SEQ").val(json.data.SEQ);
                    $("#NAME").val(json.data.NAME);
                    $("#REGNO").val(json.data.REGNO);
                    $("#POSTCODE").val(json.data.POSTCODE);
                    $("#ADDRESS").val(json.data.ADDRESS);
                    $("#ADDRESSEXTRA").val(json.data.ADDRESSEXTRA);
                    $("#CONTACT").val(json.data.CONTACT);
                    $("#HRONAME").val(json.data.HRONAME);
                    $("#HROCONTACT").val(json.data.HROCONTACT);
                    $("#HRORANK").val(json.data.HRORANK);
                    $('#userEditModal').modal();
                }
            })
            .fail(function(sender, message, details){
                alert("유저정보를 가져오는 도중에 오류가 발생했습니다.");
                return false;
            });

        };
        function saveUser() {
        doPostCallSync("/mart/update", {
            SEQ: $("#SEQ").val(),
            NAME: $("#NAME").val(),
            REGNO: $("#REGNO").val(),
            POSTCODE: $("#POSTCODE").val(),
            ADDRESS: $("#ADDRESS").val(),
            ADDRESSEXTRA: $("#ADDRESSEXTRA").val(),
            CONTACT: $("#CONTACT").val(),
            HRONAME: $("#HRONAME").val(),
            HROCONTACT: $("#HROCONTACT").val(),
            HRORANK: $("#HRORANK").val(),
        })
        .success(function(json){
            if (json.result == "success") location.reload();
        })
        .fail(function(sender, message, details){
            alert("유저 업데이트 오류 발생..");
            return false;
        });        
    };
        // 유저 생성
        // function updateUser() {


        // };

        $(document).ready(function() {
            // 페이저 만들기
            if (totalCount <= rowCount) {
                $('#users-page').hide();
            } else {
                createPager('users-page', totalCount, rowCount, page, 5, `/user/list?name=${$('#name').val()}`);
            }

        });
</script>
